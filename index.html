<!DOCTYPE HTML>
<!--

    Copyright (C) 2011 Everit Kft. (http://www.everit.org)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<html>

<head>
<meta charset="utf-8">
<title>Authentication CAS</title>
<link rel="icon" type="image/ico" href="http://www.everit.org/fonts/favicon.ico">

<!--    <link rel="stylesheet" type="text/css" href="common/css/base.css">-->
<link href="http://www.everit.org/css/bootstrap.min.css" rel="stylesheet">
<link href="http://www.everit.org/css/docs.min.css" rel="stylesheet">
<link href="http://www.everit.org/css/everit.css" rel="stylesheet">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push([ '_setAccount', 'UA-15041869-4' ]);
  _gaq.push([ '_setDomainName', 'everit.org' ]);
  _gaq.push([ '_trackPageview' ]);
</script>
</head>

<body class="bs-docs-home" data-spy="scroll" data-target="#affix-nav">
  <a class="sr-only" href="#content">Skip to main content</a>
  <header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
    <div class="container">
      <div class="navbar-header">
        <button class="navbar-toggle" type="button" data-toggle="collapse"
          data-target=".bs-navbar-collapse">
          <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span
            class="icon-bar"></span> <span class="icon-bar"></span>
        </button>
        <a href="#" class="navbar-brand">Index</a>
      </div>
      <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
        <ul class="nav navbar-nav">
          <li><a href="https://github.com/everit-org/authentication-cas" target="_blank">Source</a></li>
          <li><a href="http://www.everit.org/" target="_blank">Community</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="http://www.everit.biz" target="_blank">Enterprise</a></li>
          <li><a href="http://everitorg.wordpress.com/" target="_blank">Blog</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="bs-docs-masthead everit-header" id="content" role="main">
    <div class="container">
      <span class="bs-docs-booticon bs-docs-booticon-lg bs-docs-booticon-outline"> <img
        class="logo" src="http://www.everit.org/fonts/sbz_e.svg" alt="E">
      </span>
      <p class="lead">Authentication CAS</p>
    </div>
  </div>
  <div class="container">
    <div class="col-md-10">

      <div class="bs-docs-featurette cookbook">
        <h2 id="introduction" class="bs-docs-featurette-title">Introduction</h2>
        <p>
          Authentication mechanism implemented based on <a
            href="http://everitorg.wordpress.com/2014/07/31/everit-authentication/">Everit
            Authentication</a> in case of using CAS. It is recommended to use this component in
          combination with <a href="https://github.com/everit-org/authentication-http-session">authentication-http-session</a>
          component, check the <b>Usage</b> section for more details and check check the javadoc of
          the <i>org.everit.authentication.cas</i> package.
        </p>
      </div>
      <hr class="featurette-divider">

      <div class="bs-docs-featurette cookbook">
        <h2 id="usage" class="bs-docs-featurette-title">Usage</h2>
        <p>This usage example demonstrates how to use this component with Jetty Web Server.</p>
        <p>Get the services of the following interfaces in the way you like:</p>
        <pre class="prettyprint">// sessionAuthenticationFilter and sessionLogoutServlet are provided by the 
// authentication-http-session component, casAuthenticationFilter and 
// casAuthenticationEventListener are provided by this authentication-cas 
// component.

// The sessionAuthenticationFilter is responsible to check the HTTP session 
// for an Authenticated Resource ID and execute the authenticated process in 
// the name of it if available.
Filter sessionAuthenticationFilter = ...

// The sessionLogoutServlet is responsible to invalidate the HTTP session
// of the current user.
Servlet sessionLogoutServlet = ...

// The casAuthenticationFilter handles the CAS service ticket validation and 
// CAS logout request processing.
Filter casAuthenticationFilter = ...

// The casAuthenticationEventListener ensures the operation of the component.
// This EventListener must be registered exactly twice in case of Jetty:
//  - to the ServletContextHandler
//  - to the HashSessionManager
EventListener casAuthenticationEventListener = ...</pre>
        <p>Initialize the Jetty Web Server on port 8080:</p>
        <pre class="prettyprint">Server server = new Server(8080);</pre>
        <p>
          Initialize a <i>ServletContextHandler</i> the handles the registered <i>Filters</i>, <i>Servlets</i>
          and <i>EnventListeners</i>:
        </p>
        <pre class="prettyprint">// Instantiate a ServletContextHandler that support HTTP sessions.
ServletContextHandler servletContextHandler = 
    new ServletContextHandler(ServletContextHandler.SESSIONS);

// The order of the filter registration is important.

// Register the sessionAuthenticationFilter with URL pattern "/*".
servletContextHandler.addFilter(
    new FilterHolder(sessionAuthenticationFilter), "/*", null);

// Register the casAuthenticationFilter with URL pattern "/*".
servletContextHandler.addFilter(
    new FilterHolder(casAuthenticationFilter), "/*", null);

// Register the sessionLogoutServlet with URL path "/logout".
servletContextHandler.addServlet(
    new ServletHolder("sessionLogoutServlet", sessionLogoutServlet), "/logout");

// Register the casAuthenticationEventListener to the ServletContextHandler. 
// The CasAuthenticationComponent implements the ServletContextListener 
// interface, this will be registered in this case.
servletContextHandler.addEventListener(
    casAuthenticationEventListener);

// Register the ServletContextHandler to the Server.
server.setHandler(servletContextHandler);</pre>
        <p>Initialize a persistent session manager:</p>
        <pre class="prettyprint">HashSessionManager sessionManager = new HashSessionManager();

// Store the sessions in a file system.
sessionManager.setStoreDirectory(
    new File("/the/jetty/sessions/will/be/stored/here/"));

// !!!-IMPORTANT-!!! Lazy load is required to initialize the servlet context 
// before restoring the sessions.
sessionManager.setLazyLoad(true);

// Register the EventListener to the session manager.
sessionManager.addEventListener(casAuthenticationEventListener);

// Register the session manager to the session handler.
SessionHandler sessionHandler = servletContextHandler.getSessionHandler();
sessionHandler.setSessionManager(sessionManager);</pre>
        <p>Start (and optionally join) the Jetty Web Server:</p>
        <pre class="prettyprint">server.start();

// Optionally to have the current thread wait until the server is running.
server.join();</pre>
        <p>Finally we have a Jetty Web Server with persistent session management integrated to a
          CAS server that handles authentication. Some important notes:</p>
        <ul>
          <li>The server will accept and the filters will check all the requests that match the
            "/*" pattern.</li>
          <li>Redirecting the user to the CAS login page (with a service URL, for e.g.
            "https://cas.example.com/cas/login?service=http%3A%2F%2Fapp.example.com%2F", note that
            the URL in the service parameter is URL encoded) - if authentication is required - is
            the responsibility of the application, not covered by this example either the component.</li>
          <li>Any service URL (The URL which identifies the service in the CAS server and the
            user will be redirected to this page after a successful CAS login. GET parameters in the
            URL is also supported) will be accepted because the <i>casAuthenticationFilter</i>
            listens on patter "/*". The filter will validate the service ticket provided by the CAS
            server and will invalidate the session of the user if a logout request is sent by the
            CAS server.
          </li>
          <li>Invoking the <i>sessionLogoutServlet</i> on URL "http://app.example.com/logout"
            will invalidate the session of the user managed by the session manager registered to
            Jetty Web Server. The user remains logged in to CAS. If a new request is sent to the
            Jetty Web Server, a new session will be created and assigned to the same user because of
            a CAS cookie still exists and valid. It is the responsibility of the application to <i>Single
              Logout (SLO)</i> the user (if required) by invoking the CAS logout URL (for e.g.
            "https://cas.example.com/cas/logout") on the CAS server. Invoking CAS logout also
            invalidates the session of the user because the <i>casAuthenticationFilter</i> processes
            the logout request sent by the CAS server (back channel communication).
          </li>
        </ul>
        <p>
          A complex example can be found under the integration tests project in the <a
            href="https://github.com/everit-org/authentication-cas-ecm">authentication-cas-ecm</a>.
        </p>
      </div>
      <hr class="featurette-divider">

      <div class="bs-docs-featurette cookbook">
        <h2 id="useful_cas_links" class="bs-docs-featurette-title">Useful CAS links</h2>
        <ul>
          <li><a href="http://jasig.github.io/cas/4.0.0/index.html">CAS 4.0.0 home page</a></li>
          <li><a href="http://jasig.github.io/cas/4.0.0/images/cas_flow_diagram.png">CAS
              flow diagram</a></li>
          <li><a
            href="http://jasig.github.io/cas/4.0.0/installation/Logout-Single-Signout.html">Logout
              and Single Logout (SLO)</a></li>
        </ul>
      </div>
      <hr class="featurette-divider">

      <div class="bs-docs-featurette cookbook">
        <h2 id="concept" class="bs-docs-featurette-title">Concept</h2>
        <p>
          Full authentication concept is available on blog post <a
            href="http://everitorg.wordpress.com/2014/07/31/everit-authentication/">Everit
            Authentication</a>.
        </p>
      </div>
      <hr class="featurette-divider">
    </div>

    <!--        Affix-->
    <div class="col-md-2 col-sm-0 col-xs-0">
      <nav id="affix-nav">
        <ul class="nav nav-pills nav-stacked everit-affix" data-spy="affix" data-offset-top="350"
          data-offset-bottom="140">
          <li class="active"><a href="#introduction">Introduction</a></li>
          <li><a href="#usage">Usage</a></li>
          <li><a href="#useful_cas_links">Useful CAS links</a></li>
          <li><a href="#concept">Concept</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <div></div>
  <footer class="bs-docs-footer" role="contentinfo">
    <div class="container">
      <div class="bs-docs-social">
        <ul class="bs-docs-social-buttons">
          <li class="follow-btn "><a href="https://twitter.com/EveritOrg"
            class="twitter-follow-button" data-show-count="true">Follow @EveritOrg</a></li>
          <li class="tweet-btn"><a href="https://twitter.com/share"
            class="twitter-share-button" data-url="http://www.everit.org/">Tweet</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- Bootstrap core JavaScript
================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="http://www.everit.org/js/jquery-2.1.1.min.js"></script>
  <script src="http://www.everit.org/js/bootstrap.min.js"></script>
  <script src="http://www.everit.org/js/everit.js "></script>
  <script type="text/javascript">
      (function() {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl'
            : 'http://www')
            + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  <script src="http://www.everit.org/js/prettify/run_prettify.js"></script>
</body>

</html>
